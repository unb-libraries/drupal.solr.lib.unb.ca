language: php

services:
  - docker

php:
  - '7.2'

git:
  depth: 1

before_install:
  - curl -Ls https://raw.githubusercontent.com/unb-libraries/dockworker/3.x/scripts/travis/init.sh | bash
  - composer install

script:
  - set -e
  - vendor/bin/dockworker local:build-test
  - vendor/unb-libraries/dockworker/scripts/kubectl/init.sh
  - vendor/bin/dockworker image:deploy $TRAVIS_BRANCH
  - vendor/bin/dockworker deployment:logs:check $TRAVIS_BRANCH

notifications:
  slack:
    rooms:
      secure: Uxj4PWAUxYdzcmmbbGCAuHpwQNWVBMBeTTF42LFFhGzY0uf5aF0YSANr7iKSdm3UDopm5IwA8LYl22bCn2CoojmIsR3cvVhMpfaG1iRRiXl/CLu/scwQRL4+UD2rEdoVO6L7c/fJ3upS8SGS+hdrqqc+npo9TwtUYvM8SR7D5bYwKXssMEIktSGa79rTnYm7c++qK14f2QARXETeS5i3UDSSXYaR5zz4moogfNMmP3VbLQZUTAjy1gzKSHrdHhtSh2ZeA62OgydNbrB5N+bjM1/BWexzgAD9BKuY6H+vRsgNnwQ41qerHxKKHzwk0l4N7f32gSrpUqaFxWtbEMSvwC4t/jwAAHnywxmv3Eorpatbv8U+ukKfekXPGyHUpH8TB6gvDKIT7LCIL8BtuupLxaow0h1cCqCTyCw0PaSlMeerXIXIwI0wNtaxavEgDqB4fAz+E0oOycqA9HGi7e/rLEjbSBl0c0KKa98GGkKCGC+/fIA/BE80Py916s1sxtQGWuiwQpoyLJvMbxpZbsJwzfXXBWV9uh8/iCm3PxRu+4p3A/AIdvjnmFTfxgXjIc0oVrkZX5OD4Em85/MKNSZW8crnUgIaYgWfofkx875L7+dWO1wFTuQfJ7Ikdlbz3z+t3eXS342fn2SQ7UgNbzBrrkN0aRn3zJ8glbsS873WF6A=
    on_start: always
    on_success: always
